using System;
using GXPEngine;

namespace GXPEngine
{
    class Bullet : AnimationSprite
    {
        float bulletX;
        float bulletY;

        float GoToX;
        float GoToY;

        float speed;

        float step;
        float animationDrawsBetweenFrames;

        public Bullet(float bulletX, float bulletY, float GoToX, float GoToY) : base("bullet_tile.png", 3, 1)
        {
            Spawn();

            x = bulletX;
            y = bulletY;

            this.GoToX = GoToX;
            this.GoToY = GoToY;

            animationDrawsBetweenFrames = 10;
            step = 0;

            speed = 8f;
        }

        //----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
        //                                                                                                                        Spawn()
        //----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
        void Spawn()
        {
            SetOrigin(width / 2, height / 2);
            SetXY(bulletX, bulletY);
        }

        //----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
        //                                                                                                                        MoveBullets()
        //----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
        public void MoveBullets()
        {
            float deltaX = GoToX - x;
            float deltaY = GoToY - y;

            float distance = Mathf.Sqrt(deltaX * deltaX + deltaY * deltaY);

            if (distance > speed)
            {
                x += deltaX * speed / distance;
                y += deltaY * speed / distance;
            }
        }

        //----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
        //                                                                                                                        HandleRemove()
        //----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
        void HandleRemove()
        {
            if (x <= -1500)
            {
                LateDestroy();
                LateRemove();
            }
        }

        //----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
        //                                                                                                                        HandleAnimation()
        //----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
        void HandleAnimation()
        {
            step = step + 1;

            if (step > animationDrawsBetweenFrames)
            {
                NextFrame();
                step = 0;
            }
        }

        //----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
        //                                                                                                                        OnCollision()
        //----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
        public void OnCollision(GameObject other)
        {
            if (other is Hitbox_Player)
            {
                LateDestroy();
                LateRemove();
            }
        }

        //----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
        //                                                                                                                        Update()
        //----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
        void Update()
        {
            MoveBullets();
            HandleAnimation();

            HandleRemove();
        }
    }
}
