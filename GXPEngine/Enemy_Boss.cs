using System;									// System contains a lot of default C# libraries 
using GXPEngine;								// GXPEngine contains the engine

namespace GXPEngine
{
    public enum BossState
    {
        None,
        Idle,
        AttackGrenade,
        AttackShotgun,
        AttackSpawnEnemies,
        Vulnerable
    }

    public class Enemy_Boss : AnimationSprite
    {
        BossState currentState = BossState.None;

        Grenade _grenade;
        Bullet _bullet;

        float stepIdle;
        float animationDrawsBetweenFramesIdle;
        float countFramesIdle;

        float stepAG;
        float animationDrawsBetweenFramesAG;
        float countFramesAG;

        float stepAS;
        float animationDrawsBetweenFramesAS;
        float countFramesAS;

        float bossX;
        float bossY;

        bool granadesHaveSpawned;

        Hitbox_Boss _hitbox_boss;

        public Enemy_Boss(float bossX, float bossY) : base("enemy_boss_tile.png", 7, 3)
        {
            Spawn();

            x = bossX;
            y = bossY;

            animationDrawsBetweenFramesIdle = 10;
            animationDrawsBetweenFramesAG = 10;
            animationDrawsBetweenFramesAS = 10;

            SetState(BossState.AttackGrenade);
        }

        //----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
        //                                                                                                                        SetState()
        //----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
        void SetState(BossState newState)
        {
            if (currentState != newState)
            {
                HandleStateTransition(currentState, newState);
                currentState = newState;
            }
        }

        //----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
        //                                                                                                                        HandleStateTransition()
        //----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
        void HandleStateTransition(BossState oldState, BossState newState)
        {
            if (newState == BossState.Idle)
            {
                SetFrame(0);
            }

            if (newState == BossState.AttackGrenade)
            {
                SetFrame(7);
            }

            if (newState == BossState.AttackShotgun)
            {
                SetFrame(14);
            }

            if (newState == BossState.AttackSpawnEnemies)
            {
                SetFrame(21);
            }

            if (newState == BossState.Vulnerable)
            {
                SetFrame(21);
            }
        }

        //----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
        //                                                                                                                        HandleState()
        //----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
        void HandleState()
        {
            if (currentState == BossState.Idle)
            {
                HandleIdleState();
            }
            if (currentState == BossState.AttackGrenade)
            {
                HandleAttackGrenadeState();
            }
            if (currentState == BossState.AttackShotgun)
            {
                HandleAttackShotgunState();
            }
            if (currentState == BossState.AttackSpawnEnemies)
            {
                HandleAttackSpawnEnemieState();
            }
            if (currentState == BossState.Vulnerable)
            {
                HandleVulnerableState();
            }
        }

        //----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
        //                                                                                                                        HandleIdleState()
        //----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
        void HandleIdleState()
        {
            stepIdle = stepIdle + 1;

            if (stepIdle > animationDrawsBetweenFramesIdle)
            {
                NextFrame();
                stepIdle = 0;
                countFramesIdle = countFramesIdle + 1;
            }

            if (countFramesIdle >= 7)
            {
                SetFrame(0);
                countFramesIdle = 0;
            }
        }

        //----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
        //                                                                                                                        HandleAttackGrenadeState()
        //----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
        void HandleAttackGrenadeState()
        {
            if (granadesHaveSpawned == false)
            {
                HandleGrenades();

                stepAG = stepAG + 1;

                if (stepAG > animationDrawsBetweenFramesAG)
                {
                    NextFrame();
                    stepAG = 0;
                    countFramesAG = countFramesAG + 1;
                }

                if (countFramesAG >= 14)
                {
                    countFramesAG = 8;
                }
            }

            if (granadesHaveSpawned == true)
            {
                SetState(BossState.Idle);
            }
        }

        //----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
        //                                                                                                                        HandleAttackShotgunState()
        //----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
        void HandleAttackShotgunState()
        {
            HandleBullets();

            stepAS = stepAS + 1;

            if (stepAS > animationDrawsBetweenFramesAS)
            {
                NextFrame();
                stepAS = 0;
                countFramesAS = countFramesAS + 1;
            }

            if (countFramesAS >= 21)
            {
                countFramesAS = 15;
            }
        }

        //----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
        //                                                                                                                        HandleAttackSpawnEnemieState()
        //----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
        void HandleAttackSpawnEnemieState()
        {

        }

        //----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
        //                                                                                                                        HandleVulnerableState()
        //----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
        void HandleVulnerableState()
        {
            if (currentState == BossState.Vulnerable)
            {
                Globals.bossIsAttacking = true;
            }
            else
            {
                Globals.bossIsAttacking = false;
            }
        }

        //----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
        //                                                                                                                        HandleGrenades()
        //----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
        void HandleGrenades()
        {
            if (countFramesAG == 8 && granadesHaveSpawned == false)
            {
                _grenade = new Grenade(-1075, -100, 490);
                AddChild(_grenade);

                _grenade = new Grenade(-800, -100, 700);
                AddChild(_grenade);

                _grenade = new Grenade(-1300, -100, 700);
                AddChild(_grenade);

                granadesHaveSpawned = true;
            }
        }

        //----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
        //                                                                                                                        HandleBullets()
        //----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
        void HandleBullets()
        {
            _bullet = new Bullet(-1075, 0, 0, 0);
            AddChild(_bullet);
        }

        //----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
        //                                                                                                                        Spawn()
        //----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
        void Spawn()
        {
            SetFrame(0);

            SetXY(bossX, bossY);
            SetOrigin(width, 0);

            _hitbox_boss = new Hitbox_Boss();
            AddChild(_hitbox_boss);
        }

        //----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
        //                                                                                                                        HandleDeath()
        //----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
        void HandleDeath()
        {
            if (Globals.bossIsDead == true)
            {
                LateDestroy();
                LateRemove();
            }
        }

        //----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
        //                                                                                                                        Update()
        //----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
        void Update()
        {
            HandleState();
            HandleDeath();
        }
    }
}
